<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM Frame - Fit Template</title>

<!-- Welcome to ZIM at https://zimjs.com - Code Creativity!              	        -->
<!-- ZIM runs on the HTML Canvas powered by JavaScript and CreateJS https://createjs.com -->
<!-- Founded by Inventor Dan Zen - http://danzen.com - Canadian New Media Award Winner 	-->
<!-- ZIM is free to use. You can donate to help improve ZIM at http://zimjs.com/donate 	-->

<script src="js/createjs_1.1_min.js"></script>
<script src="js/zim_7.3.2.js"></script>
<!-- use zimjs.com/distill for minified individual functions! -->

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="assets/fontawesome/css/all.css" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="js/const.js"></script>
  <script src="js/logs.js"></script>
  <script src="js/queueElement.js"></script>
  <script src="js/queuePlace.js"></script>
  <script src="js/queue.js"></script>
  <script src="js/timer.js"></script>
  


<style>

	body {background-color:#ddd;}
	article {font-size:14px; font-family:verdana; padding:20px;  margin:20px; color:#555; position:relative; width:60%; border:thin solid #888;}

	#holder {position:relative; margin:0px 0px;}
	/*
	zim Frame makes a canvas tag and adds it to the div called holder
	the id of canvas tag is holderCanvas (Frame adds the word Canvas to the holder id)
	here we are using CSS to scale the canvas but the stage dimensions stay fixed to the values provided to Frame
	*/
	#holderCanvas {width:100%;}
	
	.sidebar{
      padding: 20px 15px;
      background:  #fff;
	  height: 100vh;
	  overflow: auto;
      border-right: 1px solid #C7B4A6;
    }
	
	#mainbar{
		padding: 0px;
		position: relative;
		height: 100vh;
		overflow: auto;
		background-color: gray;
    }

.btn-mainbar-1 {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #424242), color-stop(1, #4d4d4d));
	background:-moz-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-webkit-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-o-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-ms-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:linear-gradient(to bottom, #424242 5%, #4d4d4d 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#424242', endColorstr='#4d4d4d',GradientType=0);
	background-color:#424242;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	border: 0px;
	font-family:Arial;
	font-size:14px;
	font-weight:bold;
	padding:10px 30px;
	text-decoration:none;
}
.btn-mainbar-1:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #4d4d4d), color-stop(1, #424242));
	background:-moz-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-webkit-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-o-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-ms-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:linear-gradient(to bottom, #4d4d4d 5%, #424242 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#4d4d4d', endColorstr='#424242',GradientType=0);
	background-color:#4d4d4d;
}
.btn-mainbar-1:active {
	position:relative;
	top:1px;
}

.btn-mainbar-2 {
	background-color:#ffffff;
	display:inline-block;
	cursor:pointer;
	color:#000000;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:10px 23px;
	border: 0px;
	text-decoration:none;
}
.btn-mainbar-2:hover {
	background-color:#bababa;
}
.btn-mainbar-2:active {
	position:relative;
	top:1px;
}

.setting{
	margin-bottom: 10px;
}

#cellIdSettingValue, #eulHsUsersCountSettingValue, #speechUsersCountSettingValue{
	text-align: right;
}

.alert-bottom{
    position: absolute;
    bottom: 10px;
    left:2%;
    width: 96%;
}
	

</style>

<script>

var frame;
var ERICSSON_BLUE = "#032564"
var WHITE = "#D2D2D2"
var cellArray = new Array();
var ueGuiContainer = new Container();
var ueArray = new Array();
var draggingObject = false;

var cellRange = 250;

var queuingTime = 9090;

var sidebarElements = new Array();

function Cell(id, resources, startPosX, startPosY, queuePlacement) {
	var self = this;

  this.id = id;
  this.eulHsUsersCount = 0;
  this.speechUsersCount = 0;
  this.hsAdmUsers = resources;
  this.speechAdmUsers = resources;
  this.psresources = resources;
  this.csresources = resources;
  
  this.queuePlacement = queuePlacement;
  this.startPosX = startPosX;
  this.startPosY = startPosY;
  
  this.admissionQueue = new Queue(self);
  
  this.getInfo = function() 
  {
	return 'cell_id: ' + this.id + ', resources: ' + this.resources; 
  };
  
  this.admissionReq = function(ue,prio,connType){
  
	switch(connType)
	{
		case connectionType.EULHS:
			if(this.eulHsUsersCount < this.hsAdmUsers){
				return {continuation : true, admissionQueued: false};
			}else{
				zog("admission reject for ps in cell: " + this.id);
				var queued = this.admissionQueue.addToQueue(ue,prio,queueingType.PS);
				return {continuation : false, admissionQueued: queued};
			}
		break;
		case connectionType.SPEECH:
			if(this.speechUsersCount < this.speechAdmUsers){
				return {continuation : true, admissionQueued: false};
			}else{
				zog("admission reject for speech in cell: " + this.id);
				var queued = this.admissionQueue.addToQueue(ue,prio,queueingType.SPEECH);
				return {continuation : false, admissionQueued: queued}; // TODO add to queue for speech
			}
		break;
		default:
	}
  }
  
  this.admissionQueueRemoveUe = function(ue, prio, queueingType){
	return this.admissionQueue.removeFromQueue(ue, prio, queueingType);
  }
  
  this.showQueue = function(){
	switch(this.queuePlacement){
		case 'left':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0.5, x:0}, time:200});
			break;
		
		case 'right':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0.5, x:0}, time:200});
			break;
		
		case 'bottom':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0.5, y:0}, time:200});
			break;
		
		default:
			break;
	}
  }
  
  this.hideQueue = function(){
  	switch(this.queuePlacement){
		case 'left':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0, x:50}, time:200});
			break;
		
		case 'right':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0, x:-50}, time:200});
			break;
		
		case 'bottom':
			this.admissionQueue.admissionQueueContainer.getChildAt(0).animate({obj:{alpha:0, y:-50}, time:200});
		break;
		
		default:
			break;
	}
  }
}

function UE(id, startPosX, startPosY, startCell){

	var self = this;
	
	this.id = id;
	this.terminatingUe = undefined;
	this.startCell = startCell;
    this.startPosX = startPosX;
    this.startPosY = startPosY;
	this.speechPriority = 1;
	this.psPriority = 5;
	
	if(id == 1){
		this.psPriority = 5;
	}
	if(id == 2){
		this.psPriority = 6;
	}
	if(id == 3){
		this.psPriority = 7;
	}
	
	this.psconnection = false;
	this.csconnection = false;
	this.psQueueingTimer = new Timer(queuingTime, self, queueingType.PS);
	this.speechQueueingTimer = new Timer(queuingTime, self, queueingType.SPEECH);
	self.psQueueingInfo = new Array({cellId: 1, isQueued: false},{cellId: 2, isQueued: false},{cellId: 3, isQueued: false});
	self.speechQueueingInfo = new Array({cellId: 1, isQueued: false},{cellId: 2, isQueued: false},{cellId: 3, isQueued: false});
	
	self.psQueueElement = new QueueElement();
	self.speechQueueElement = new QueueElement();
	
	this.connectionInfo = function(){
		if(this.psconnection && this.csconnection)
		{
			return 'int_eul_hs_speech_12_2'
		}
		else if(this.psconnection)
		{
			return 'int_eul_hs'
		}
		else if(this.csconnection)
		{
			return 'speech_12_2'
		}
		return undefined;
	}
	
	this.cellsInRange = new Array();
	this.activeSet = new Array();
	
	this.startPsConnection = function(){
		
		if(this.csconnection == true) // Check ps resources for 
		{
			
			for(var i = 0; i < this.activeSet.length; i++)
			{
				
				var requestResult = getCellById(this.activeSet[i].cellId).admissionReq(self,this.psPriority,connectionType.EULHS);
				
				if(!requestResult.continuation){
					DANGER('EULHS was not established for UE: ' + this.id + ' due to not enought resources in cell:  ' + this.activeSet[i].cellId);
				
					if(requestResult.admissionQueued == 'queued'){
						
						this.setPsQueued(this.activeSet[i].cellId);
					
						this.startPsQueueingTime();
					}
					
					refreshSidebar();
					return;
				}
			}
			
			this.psconnection = true;
		}
		else
		{
			
			var requestResult = getCellById(this.startCell).admissionReq(self,this.psPriority,connectionType.EULHS);
			
			if(!requestResult.continuation){
				DANGER('EULHS was not established for UE: ' + this.id + ' due to not enought resources in cell:  ' + this.startCell);
				
				if(requestResult.admissionQueued == 'queued'){
				
					this.setPsQueued(this.startCell);
					
					this.startPsQueueingTime();
				}
				
				refreshSidebar();
				return;
			}
			
			this.activeSet.push({cellId:this.startCell});
			this.psconnection = true;
		}
		
				
		if(this.psconnection){
		
			for(var i = 0; i < this.activeSet.length; i++){
				getCellById(this.activeSet[i].cellId).eulHsUsersCount++;
			}
			
			this.gui.getChildAt(0).getChildAt(1).animate({obj:{alpha:1}, time:500});
			
			SUCCESS('EULHS established for UE: ' + this.id + ', ActiveSet = ' + this.activeSetToString());
			
		}
		
		this.setCellsInRange();
		this.updateActiveSet(cellArray);

		refreshSidebar();
	}
	
	this.stopPsConnection = function(){
	
		this.psconnection = false;
		
		for(var i = 0; i < this.activeSet.length; i++)
		{
			getCellById(this.activeSet[i].cellId).eulHsUsersCount--;
		}
		
		this.setCellsInRange();
		this.updateActiveSet(cellArray);
		
		this.gui.getChildAt(0).getChildAt(1).animate({obj:{alpha:0}, time:500});
		
		refreshSidebar();
	}
	
	this.startCsConnection = function(terminatingUeId){
	
		this.terminatingUe = terminatingUeId;
	
		if(this.psconnection == true)
		{
			for(var i = 0; i < this.activeSet.length; i++)
			{
				var requestResult = getCellById(this.activeSet[i].cellId).admissionReq(self, this.speechPriority, connectionType.SPEECH);

				if(!requestResult.continuation){
					DANGER('Speech was not established for UE: ' + this.id + ' due to not enought resources in cell:  ' + this.activeSet[i].cellId);
					
					if(requestResult.admissionQueued == 'queued'){
						this.setSpeechQueued(this.activeSet[i].cellId);
						this.startSpeechQueueingTime();
					}
					
					refreshSidebar();
					return false;
				}
			}
			this.csconnection = true;
		}
		else
		{
			var requestResult = getCellById(this.startCell).admissionReq(self, this.speechPriority, connectionType.SPEECH);
		
			if(!requestResult.continuation){
					DANGER('Speech was not established for UE: ' + this.id + ' due to not enought resources in cell:  ' + this.startCell);
					
					if(requestResult.admissionQueued == 'queued'){
					
						this.setSpeechQueued(this.startCell);
						this.startSpeechQueueingTime();
						
					}
					
					refreshSidebar();
					return false;
			}
			this.activeSet.push({cellId:this.startCell});
			this.csconnection = true;
		}
		
		
		if(this.csconnection){
			for(var i = 0; i < this.activeSet.length; i++){
				getCellById(this.activeSet[i].cellId).speechUsersCount++;
			}
			
			this.gui.getChildAt(0).getChildAt(0).animate({obj:{alpha:1}, time:500});
		
			SUCCESS('Speech established for UE: ' + this.id + ', ActiveSet = ' + this.activeSetToString());
			
		}
		
		this.setCellsInRange();
		this.updateActiveSet(cellArray);
		
		if(getUeById(this.terminatingUe).csconnection == false){
			if(!getUeById(this.terminatingUe).startCsConnection(this.id)){
				this.stopCsConnection();
			}
		}
		
		refreshSidebar();
		
		return true;
	}
	
	this.stopCsConnection = function(){
	
		if(this.csconnection){
			for(var i = 0; i < this.activeSet.length; i++)
			{
				getCellById(this.activeSet[i].cellId).speechUsersCount--;
			}
			
			this.csconnection = false;
			
			if(getUeById(this.terminatingUe).csconnection){
				getUeById(this.terminatingUe).stopCsConnection();
			}
			
			this.terminatingUe = undefined;
			
			this.setCellsInRange();
			this.updateActiveSet(cellArray);
			
			this.gui.getChildAt(0).getChildAt(0).animate({obj:{alpha:0}, time:500});
		}
		
		refreshSidebar();
	}
	
	this.getInfo = function(){
		return 'UE(id: ' + this.id + ', startCell: ' + this.startCell + ', activeSet = ' + this.activeSetToString() + ', connection: ' +  this.connectionInfo() + ', cellsInRange = [' + this.cellsInRange.toString() + ']' + ')';
	};
	
	this.activeSetToString = function(){
		var string = '[';
		for(var i = 0; i < this.activeSet.length; i++){
			string = string + 'Cell_' + this.activeSet[i].cellId;
			
			if( i+1 < this.activeSet.length){
				string = string + ',';
			}
		}
		
		string = string + ']';
		
		return string;
	}
	
	this.setStartCell = function(cells){
	
		var noOfCells = cells.length;
		var distance = 9999;
		var startCell = undefined;
		
		for(var i = 0; i<noOfCells; i++)
		{
			var c = dist(cells[i].gui.x, cells[i].gui.y,this.gui.x,this.gui.y);
			
			if(c < cellRange && c < distance)
			{
				distance = c;
				startCell = cells[i].id;
			}
		}
		
		if(this.startCell != startCell){
		
			this.startCell = startCell;
		
			if(this.isAnyPsInQueue()){
				zog('ps in queue');
				this.stopPsQueueingTime();
				this.deleteFromQueue(queueingType.PS);
				this.startPsConnection();
			}
			
			if(this.isAnySpeechInQueue()){
				this.stopSpeechQueueingTime();
				this.deleteFromQueue(queueingType.SPEECH);
				this.startCsConnection(this.terminatingUe);
			}
		}
	};
	
	this.startPsQueueingTime = function(){
	
		self.psQueueingTimer.startTimer();
		
	};
	
	this.stopPsQueueingTime = function(){
	
		self.psQueueingTimer.stopTimer();
		
		
	};
	
	this.updatePsQueuingTimer = function(){
		
		var time = self.gui.getChildAt(1).getChildAt(3);
		
		time.text = self.psQueueingTimer.getCurrentTimeString();
	}
	
	this.startPsQueueingTime = function(){
	
		self.psQueueingTimer.startTimer();
		
	};
	
	this.startSpeechQueueingTime = function(){
	
		zog("startSpeechQueueingTime");
		self.speechQueueingTimer.startTimer();
		
	};
	
	this.stopSpeechQueueingTime = function(){
		self.speechQueueingTimer.stopTimer();
	};
	
	this.updateSpeechQueuingTimer = function(){
		
		var time = self.gui.getChildAt(2).getChildAt(3);
		
		time.text = self.speechQueueingTimer.getCurrentTimeString();
	}
	
	this.setPsQueued = function(cellId){
		for(var i = 0; i < this.psQueueingInfo.length; i++){
		
			if(this.psQueueingInfo[i].cellId == cellId){
				this.psQueueingInfo[i].isQueued = true;
			}
		}
	}
	
	this.setSpeechQueued = function(cellId){
		for(var i = 0; i < this.speechQueueingInfo.length; i++){
			if(this.speechQueueingInfo[i].cellId == cellId){
				this.speechQueueingInfo[i].isQueued = true;
			}
		}
	}
	
	this.isAnyPsInQueue = function(){
		for(var i = 0; i < this.psQueueingInfo.length; i++){
		
			if(this.psQueueingInfo[i].isQueued){
				return true;
			}
		}
		
		return false;
	}
	
	this.isAnySpeechInQueue = function(cellId){
		for(var i = 0; i < this.speechQueueingInfo.length; i++){
			if(this.speechQueueingInfo[i].isQueued ){
				return true;
			}
		}
		
		return false;
	}
	
	this.softHoAddition = function(cell){
	
		switch(this.connectionInfo()){
			case connectionType.EULHS: 
				zog("increase user count for cell " + cell + " by soho addition");
				getCellById(cell).eulHsUsersCount++;
				return true;
			break;
			case connectionType.SPEECH:
				getCellById(cell).speechUsersCount++;
				return true;
			break;
			
			case connectionType.SPEECHEULHS: 
				getCellById(cell).eulHsUsersCount++;
				getCellById(cell).speechUsersCount++;
				return true;
			break;
			
			default:
				return false;
			
		}
	}
	
	this.softHoDeletion = function(cell){
		switch(this.connectionInfo()){
			case connectionType.EULHS:
			
				getCellById(cell).eulHsUsersCount--;
				return true;
			break;
			case connectionType.SPEECH:

				getCellById(cell).speechUsersCount--;
				return true;
			break;
			
			case connectionType.SPEECHEULHS: 
				getCellById(cell).eulHsUsersCount--;
				getCellById(cell).speechUsersCount--;
				return true;
			break;
			
			default:
				return true;
			
		}
	}
	
	this.setCellsInRange = function(){
	
		this.cellsInRange = [];
		
		for(var i = 0; i< cellArray.length ; i++)
		{
				
			var c = dist(cellArray[i].gui.x, cellArray[i].gui.y, this.gui.x,this.gui.y);
			
			if(c < cellRange)
			{
				this.cellsInRange.push(cellArray[i].id);
			}
		}
	}
	
	this.updateActiveSet = function(cells){
		if(this.psconnection || this.csconnection){
		//check for softHoAddition
			for(var i = 0; i < this.cellsInRange.length; i++){
				var alreadyInAs = false;

				
				for(var j = 0; j < this.activeSet.length; j++){
					if(this.cellsInRange[i] == this.activeSet[j].cellId){
						alreadyInAs = true;
					}					
				}
				
				if(!alreadyInAs){
					if(this.id == 1)
						zog('now add to AS');
					if(this.softHoAddition(this.cellsInRange[i])){
						this.activeSet.push({cellId:this.cellsInRange[i]});
					}
				}
			}
			
			//check for softHoDeletion
			for(var i = 0; i < this.activeSet.length; i++){
				var inRange = false;
				
				for(var j = 0; j < this.cellsInRange.length; j++){
					if(this.activeSet[i].cellId == this.cellsInRange[j]){
						inRange = true;
					}					
				}
				
				if(!inRange){
					if(this.softHoDeletion(this.activeSet[i].cellId)){
						
						this.activeSet.splice(i,1);
				
						if(this.isAnySpeechInQueue()){
							this.deleteFromQueue(queueingType.SPEECH);
							this.stopSpeechQueueingTime();
							this.startCsConnection(this.terminatingUe);
						}
						
						if(this.isAnyPsInQueue()){
							this.deleteFromQueue(queueingType.PS);
							this.stopPsQueueingTime();
							this.startPsConnection();
						}
						
						i--;
					}
				}
			}
			
		}else{
			this.activeSet = [];
		}
	}
	
	this.getActiveSetIndexFromCellId = function(id){
		for(var i = 0; i < this.activeSet.length; i++){
			if(this.activeSet[i].cellId == id)
			{
				return i;
			}
		}
		return -1;
	}
	
	this.deleteFromQueue = function(cqType){
		if(cqType == queueingType.PS){
			zog("ue" + this.id + " delete ps from queue");
			
			for(var i = 0; i < this.psQueueingInfo.length; i++){
			
					if(this.psQueueingInfo[i].isQueued){
						zog("remove ue from cell: " + this.psQueueingInfo[i].cellId);
						
						getCellById(this.psQueueingInfo[i].cellId).admissionQueueRemoveUe(self, this.psPriority, queueingType.PS);
						
						self.psQueueingInfo[i].isQueued = false;
					}
			}
			
		}else{
			zog("ue" + this.id + " delete speech from queue");

			for(var i = 0; i < self.speechQueueingInfo.length; i++){
					if(self.speechQueueingInfo[i].isQueued){
						getCellById(self.speechQueueingInfo[i].cellId).admissionQueueRemoveUe(self, this.speechPriority, queueingType.SPEECH);
						self.speechQueueingInfo[i].isQueued = false;
					}
			}
			
		}
	}
	
	this.getGlobalPos = function(){
		return self.gui.parent.localToGlobal(self.gui.x, self.gui.y);
	}
}


	// SCALING OPTIONS
	// scaling can have values as follows with full being the default
	// "fit"	sets canvas and stage to dimensions and scales to fit inside window size
	// "outside"	sets canvas and stage to dimensions and scales to fit outside window size
	// "full"	sets stage to window size with no scaling
	// "tagID"	add canvas to HTML tag of ID - set to dimensions if provided - no scaling

	var scaling = "holder"; // this will resize to fit inside the screen dimensions
	var width = 1280;
	var height = 1060;
	var color = ERICSSON_BLUE; // ZIM colors like green, blue, pink, faint, clear, etc. available globally
	var outerColor = dark; // any HTML colors like "violet", "#333", etc. fine to use

	frame = new Frame(scaling,width,height,ERICSSON_BLUE,ERICSSON_BLUE);

	frame.on("ready", function() {
		zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

		zog(frame.canvasID);
		
		var stage = frame.stage;
		var stageW = frame.width;
		var stageH = frame.height;
		// see http://zimjs.com/learn.html for video and code tutorials
		// see http://zimjs.com/docs.html for documentation
		// see http://zimjs.com/bits.html for 64 Interactive Media techniques

		// put your code here (you can delete this sample code)
		
		frame.loadAssets(["ue.png", "call.png", "transfer.png", "admissionqueue.png" ], "assets/");

		frame.on("complete", function() {
			
			 var cell_1 = new Cell(1,0,461,301,'left');//cellId, resources, posX, posY, queuePlacement
			 cellArray.push(cell_1);
			 guiAddCell(cell_1, stage);
			 
			 var cell_2 = new Cell(2,10,843,396,'right');
			 cellArray.push(cell_2);
			 guiAddCell(cell_2, stage);
			 
			 var cell_3 = new Cell(3,10,617,652,'bottom');
			 cellArray.push(cell_3);
			 guiAddCell(cell_3, stage);
			 
			 

			 ueGuiContainer.addTo(stage).top();
			 ueGuiContainer.pos(0,0);
			 
			 var ue_1 = new UE(1, 400, 200, 1);
			 ueArray.push(ue_1);
			 guiAddUe(ue_1, stage);
			 ue_1.setStartCell(cellArray);
			 
			 var ue_2 = new UE(2, 600, 750, 3);
			 ueArray.push(ue_2);
			 guiAddUe(ue_2, stage);
			 
			 var ue_3 = new UE(3, 900, 300, 2);
			 ueArray.push(ue_3);
			 guiAddUe(ue_3, stage);
	
			for(var i = 0; i < ueArray.length; i++){
				
				ueArray[i].gui.getChildAt(0).animate({obj:{y:-110, scale:0.16}, time:500, loop:true, rewind:true, sequence:50});
			}
				
			ueGuiContainer.on("pressup", function(e){ 
			
				if(!isNaN(e.target.name)){
					if(!getUeById(e.target.name).psconnection && !getUeById(e.target.name).csconnection){ 
						getUeById(e.target.name).setStartCell(cellArray); 
					}
				}
				
				draggingObject = false;
				refreshSidebar();
			});
			
			ueGuiContainer.on("dblclick", function(e){ 
				
				
				zog(e.target.name + " dblclick");
				
				
				var mymodal = $('#modalAllLogs');
				mymodal.find('.modal-body').html(getFullLogsList());
				mymodal.modal('show');
			});
			
			ueGuiContainer.on("mousedown", function(e){
				
				draggingObject = true;
				
				refreshSidebar();
			});
			
			interval(100, function(){
				if(draggingObject)
				{
					for(var i = 0; i < ueArray.length; i++){
						ueArray[i].setCellsInRange();	
					
						if(ueArray[i].csconnection || ueArray[i].psconnection){
							ueArray[i].updateActiveSet(cellArray);
						}else{
							getUeById(ueArray[i].id).setStartCell(cellArray);
						}
					}
					refreshSidebar();
				}
			});
			
			stage.update(); // this is needed to show any changes
		}); //end of complete 
		
		stage.update();

		
	}); // end of ready


function guiAddCell(cell, stage){
	//create cell gui container
	
	cell.admissionQueue.admissionQueueContainer = new Container().addTo(stage).bot();
	
	cell.gui = new Container().addTo(stage).top();
	
	//setup start position
	cell.gui.x = cell.startPosX; 
	cell.gui.y = cell.startPosY;
	
	cell.admissionQueue.admissionQueueContainer.x = cell.startPosX; 
	cell.admissionQueue.admissionQueueContainer.y = cell.startPosY;
	
	var admissionQueueGui = new Container().addTo(cell.admissionQueue.admissionQueueContainer);
	admissionQueueGui.name = "queue gui";
	
	var admissionQueueShapeBcg;
	var admissionQueueShape;
	
	switch(cell.queuePlacement){
		case 'left':
			admissionQueueShapeBcg = new Rectangle(cellRange+100,cellRange*2,"white","white",0,20).addTo(admissionQueueGui).pos(-cellRange - 100, -cellRange);
			
			admissionQueueShape = frame.asset("admissionqueue.png").clone();
			
			admissionQueueGui.addChild(admissionQueueShape);
			
			admissionQueueShape.rot(-90);
			admissionQueueShape.sca(0.52);
			admissionQueueShape.pos(-340,245);
			
			var queuePlaceX = -295;
			var startQueuePlaceY = -200;
			  
			for(var i = 0; i < 10; i++){
				cell.admissionQueue.createQueuePlace(queuePlaceX,startQueuePlaceY,admissionQueueGui);
				startQueuePlaceY+=45;
			}
			  
			admissionQueueGui.alp(0);
			admissionQueueGui.pos(50,0);
			
		break;
		
		case 'right':
		
			admissionQueueShapeBcg = new Rectangle(cellRange+100,cellRange*2,"white","white",0,20).addTo(admissionQueueGui).pos(0,-cellRange);
			
			admissionQueueShape = frame.asset("admissionqueue.png").clone();
			
			admissionQueueGui.addChild(admissionQueueShape);
			
			admissionQueueShape.rot(-90);
			admissionQueueShape.sca(0.52);
			admissionQueueShape.pos(250,245);
			
			var queuePlaceX = 275;
			var startQueuePlaceY = -220;
			  
			for(var i = 0; i < 10; i++){
				cell.admissionQueue.createQueuePlace(queuePlaceX,startQueuePlaceY,admissionQueueGui);
				startQueuePlaceY+=45;
			}
			
			admissionQueueGui.alp(0);
			admissionQueueGui.pos(-50,0);
			
		break;
		
		case 'bottom':
			
			admissionQueueShapeBcg = new Rectangle(cellRange*2,cellRange+100,"white","white",0,20).addTo(admissionQueueGui).pos(-cellRange,0);
		
			admissionQueueShape = frame.asset("admissionqueue.png").clone();
			
			admissionQueueGui.addChild(admissionQueueShape);
			
			admissionQueueShape.sca(0.52);
			admissionQueueShape.pos(-245,250);
			
			var queuePlaceX = -225;
			var startQueuePlaceY = 275;
			
			for(var i = 0; i < 10; i++){
				cell.admissionQueue.createQueuePlace(queuePlaceX,startQueuePlaceY,admissionQueueGui);
				queuePlaceX+=45;
			}
			
		
			admissionQueueGui.alp(0);
			admissionQueueGui.pos(0,-50);
		break;
		
		default:
		break;
	}
	
	var admissionQueueMask = new Circle(cellRange, ERICSSON_BLUE);
	admissionQueueMask.addTo(cell.admissionQueue.admissionQueueContainer);// add the circle to the container and center
	admissionQueueMask.pos(0,0);
	
	//add label to gui container
	
	var cell_Range = new Circle(cellRange, WHITE);
    cell_Range.blendMode = "screen";
	cell_Range.alpha = .5;
	cell_Range.addTo(cell.gui);// add the circle to the container and center
	cell_Range.pos(0,0);
	
	
	//cell label
	var cell_Label = new Label("Cell_" + cell.id);
	cell.gui.addChild(cell_Label);
	cell_Label.pos(-50,-25);
	
	cell.gui.setBounds(0,0);
}

function guiAddUe(ue, stage){
	//create gui for whole UE interface
	ue.gui = new Container().addTo(ueGuiContainer);
	
	ue_gui_icons = new Container().addTo(ue.gui); // id 0
	ue_gui_icons.name = 'gui_icons_ue' + ue.id;
	
	//queueing timers 	
	var psQueueingTimerGui = new Container().addTo(ue.gui); //id 1
	psQueueingTimerGui.name = 'gui_psQueueingTimerGui_ue' + ue.id;
	psQueueingTimerGui.alp(0);
	psQueueingTimerGui.pos(30,-70);
	
	var speechQueueingTimerGui = new Container().addTo(ue.gui); //id 2
	speechQueueingTimerGui.name = 'gui_speechQueueingTimerGui_ue' + ue.id;
	speechQueueingTimerGui.alp(0);
	speechQueueingTimerGui.pos(30,5);
	
	//UE graphic
	var phonePNG = frame.asset("ue.png").clone();
	var callPNG = frame.asset("call.png").clone();
	var transferPNG = frame.asset("transfer.png").clone();
	
	phonePNG //id 3
		.sca(0.5)
		.addTo(ue.gui) 
		.centerReg();
	phonePNG.name = ue.id;
		
	callPNG
		.sca(0.15)
		.addTo(ue_gui_icons) 
		.centerReg()
		.pos(25,-100)
		.alp(0);
	callPNG.name = 'callIcon_ue' + ue.id;
	
	transferPNG
		.sca(0.15)
		.addTo(ue_gui_icons)
		.centerReg()
		.pos(-25,-100)
		.alp(0);
	transferPNG.name = 'transferIcon_ue' + ue.id;
	
	//UE label
	var ue_Label = new Label("UE_id_" + ue.id, 15);

	
	//add label to gui container
	ue.gui.addChild(ue_Label); // id 4
	ue_Label.pos(-25,-30);
	ue_Label.top();
	ue_Label.name = ue.id;
	
	//psQueueingTimerGui content
	
		
		var backgroundPsCqTimer = new Rectangle(150, 65, "#1767b9", "#1767b9", 5, 20)
		.addTo(psQueueingTimerGui)
		.pos(-70, 0);
		backgroundPsCqTimer.name = 'backgroundPsCqTimer_ue' + ue.id;
	
		var psCqTimerLabel_1 = new Label("PS", 15, "arial", "black");
		psCqTimerLabel_1.name = 'psCqTimeLabel1_ue' + ue.id;
		psQueueingTimerGui.addChild(psCqTimerLabel_1);
		psCqTimerLabel_1.pos(-29,5);
		
		var psCqTimerLabel_2 = new Label("queueing timer", 15, "arial", "black");
		psCqTimerLabel_2.name = 'psCqTimeLabel2_ue' + ue.id;
		psQueueingTimerGui.addChild(psCqTimerLabel_2);
		psCqTimerLabel_2.pos(-29,20);
		
		var psCqTime = new Label("", 20, "arial", "black");
		psCqTime.name = 'psCqTime_ue' + ue.id;
		//add label to gui container
		psQueueingTimerGui.addChild(psCqTime);
		psCqTime.pos(-27,40);
	
	//speechQueueingTimerGui content
		var backgroundSpeechCqTimer = new Rectangle(150, 65, "#198600", "#198600", 5, 20)
		.addTo(speechQueueingTimerGui)
		.pos(-70, 0);
		backgroundSpeechCqTimer.name = 'backgroundSpeechCqTimer_ue' + ue.id;
	
		var speechCqTimerLabel_1 = new Label("SPEECH", 15, "arial", "black");
		speechCqTimerLabel_1.name = 'speechCqTimerLabel1_ue' + ue.id;
		speechQueueingTimerGui.addChild(speechCqTimerLabel_1);
		speechCqTimerLabel_1.pos(-29,5);
		
		var speechCqTimerLabel_2 = new Label("queueing timer", 15, "arial", "black");
		speechCqTimerLabel_2.name = 'speechCqTimerLabel2_ue' + ue.id;
		speechQueueingTimerGui.addChild(speechCqTimerLabel_2);
		speechCqTimerLabel_2.pos(-29,20);
		
		var speechCqTime = new Label("", 20, "arial", "black");
		speechCqTime.name = 'speechCqTime_ue' + ue.id;
		//add label to gui container
		speechQueueingTimerGui.addChild(speechCqTime);
		speechCqTime.pos(-27,40);
	
		
	ue.gui.pos(ue.startPosX,ue.startPosY);
	ue.gui.drag({currentTarget:true});
	ue.gui.setBounds(0,0);
	ue.setStartCell(cellArray);
}


function getCellById(id){
	var noOfCells = cellArray.length;
	for(var i = 0; i<noOfCells; i++)
	{
		if(cellArray[i].id == id)
		{
			return cellArray[i];
		}
	}
	return undefined;
}

function getUeById(id){
	var noOfUEs = ueArray.length;
	for(var i = 0; i<noOfUEs; i++)
	{
		if(ueArray[i].id == id)
		{
			return ueArray[i];
		}
	}
	return undefined;
}

function getCellSettings(id){
	
	//remove all not locked elements
	var isInElements = false;
	var element = ["Cell", id, false, false, false]; //elementName, elementId, isLocked, cellInfocollapse, cellSettingscollapse
	
	for(var i = 0; i < sidebarElements.length; i++){
		if(sidebarElements[i][0] == element[0] && sidebarElements[i][1] == element[1] && sidebarElements[i][2] == true){
			zog("alredy on list");
			isInElements = true;
		}
	}
	
	var i = 0;
	while (i < sidebarElements.length) {
		if(sidebarElements[i][2]){	
			i++;
		}else{
			sidebarElements.splice(i,1);
		}
	}
	
	if(!isInElements){
		sidebarElements.push(element);
	}
	
	
	refreshSidebar();
}

function setCellSettings(id){

	var hsAdmUsersHtmlId = 'cell_' + id + '_hsAdmUsersValue';
	var speechAdmUsersHtmlId = 'cell_' + id + '_speechAdmUsersValue';
	
	var cell = getCellById(id);
	cell.hsAdmUsers = document.getElementById(hsAdmUsersHtmlId).value;
	cell.speechAdmUsers = document.getElementById(speechAdmUsersHtmlId).value;
}

function getUesListForDropDown(){
	var html = '';
	
	for(var i = 0; i<ueArray.length; i++){
		var htmlPerUe = '<li onclick="getUeSettings(' + ueArray[i].id + ')" class="btn-mainbar-2 btn-block" type="button" data-toggle="modal" data-target="#ueSettingModal">UE ' + ueArray[i].id + '</li>';
		html = html + htmlPerUe;
	}
	
	document.getElementById('uesDropdownList').innerHTML = html;
	
}

function getUeSettings(id){
		//remove all not locked elements
	var isInElements = false;
	var element = ["UE", id, false,false,false,false]; //elementName, elementId, isLocked, ueInfoCollapse, ueActionsCollapse, ueSettings collapse
	
	for(var i = 0; i < sidebarElements.length; i++){
		if(sidebarElements[i][0] == element[0] && sidebarElements[i][1] == element[1] && sidebarElements[i][2] == true){
			isInElements = true;
		}
	}
	
	var i = 0;
	while (i < sidebarElements.length) {
		if(sidebarElements[i][2]){	
			i++;
		}else{
			sidebarElements.splice(i,1);
		}
	}
	
	if(!isInElements){
		sidebarElements.push(element);
	}
	
	refreshSidebar();
}

function setUeSettings(id){

	alert("ueSetting" + id);
}

function lockPanel(panelType, id){
	
	var glyphicon = '';
	
	for(var i = 0; i < sidebarElements.length; i++){
		if(sidebarElements[i][0] == panelType && sidebarElements[i][1] == id){
			sidebarElements[i][2] = !sidebarElements[i][2];
			if(sidebarElements[i][2]){
				glyphicon = 'fas fa-lock';
			}else{
				glyphicon = 'fas fa-lock-open';
			}
		}
	}
	var elementId = panelType + "_" + id + "_lockSpan";
	
	document.getElementById(elementId).className = glyphicon;
}

function getActiveSettingsHtml(){
	if(sidebarElements.length == 0){
		return '';
	}
	
	var finalInnerHtml = '';
	
	for(var i = 0; i < sidebarElements.length ; i++){
		if(sidebarElements[i][0] == "Cell"){
			finalInnerHtml = finalInnerHtml + prepareCellSettingsPanel(sidebarElements[i][1]);
		}else{
			finalInnerHtml = finalInnerHtml + prepareUeSettingsPanel(sidebarElements[i][1]);
		}
	}
	
	return finalInnerHtml;
	
}

function prepareCellSettingsPanel(id){

 var cellInfoCollapse = false;
 var cellSettingCollapse = false;

 var finalInnerHtml ='';
 
 var part1 = '<div class="panel panel-default"><div class="panel-heading"><b>Cell';
 var part2 = '</b><span style="padding-right: 15px; float: right;" id="Cell_';
 var part3 = '_lockSpan" onclick = ';
 var part4 = '"lockPanel(';
 var part5 = "'Cell' ,"; 
 var part6 = ')" class="'
 var glyphicon = 'fas fa-lock-open';
  
 for(var i = 0; i < sidebarElements.length; i++){
	if(sidebarElements[i][0] == "Cell" && sidebarElements[i][1] == id){
		if(sidebarElements[i][2]){
			glyphicon = 'fas fa-lock';
		}
		
		if(sidebarElements[i][3]){ //info collapse
			cellInfoCollapse = true;
		}
		
		if(sidebarElements[i][4]){ //settings collapse
			cellSettingCollapse = true;
		}
	}
 }
 
 var cellInfoCollapseHtml;
 if(cellInfoCollapse){
	cellInfoCollapseHtml = '<div id="cell_' + id + '_info" class="panel-collapse collapse in" aria-expanded="true" style="">'
 }else{
	cellInfoCollapseHtml = '<div id="cell_' + id + '_info" class="panel-collapse collapse" aria-expanded="false" style="height:0px;">'
 }

 var part7 = '"></span></div><div class="panel-body"><div class="panel panel-default"><div onclick="setCollapse(' + "'Cell'" + ',' + id + ",'info'" + ')" data-toggle="collapse" href="#cell_' + id + '_info" class="panel-heading"><span style="padding-right: 15px;" class="fas fa-info"></span>Cell info</div>' + cellInfoCollapseHtml + '<div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-broadcast-tower"></span>Cell ID</div><div style="padding-right: 30px; text-align: right;" class="col-lg-4">';
 var part8 = '</div></div><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-exchange-alt"></span>EULHS users count</div><div style="padding-right: 30px; text-align: right;" class="col-lg-4">';
 var part9 = '</div></div><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-phone"></span>Speech users count</div><div style="padding-right: 30px; text-align: right;" class="col-lg-4">';
 
 var cellSettingsCollapseHtml;
 if(cellSettingCollapse){
	cellSettingsCollapseHtml = '<div id="cell_' + id + '_settings" class="panel-collapse collapse in" aria-expanded="true" style="">'
 }else{
	cellSettingsCollapseHtml = '<div id="cell_' + id + '_settings" class="panel-collapse collapse" aria-expanded="false" style="height:0px;">'
 }
 
 var part10 = '</div></div></div></div></div><div class="panel panel-default"><div onclick="setCollapse(' + "'Cell'" + ',' + id + ",'settings'" + ')" data-toggle="collapse" href="#cell_' + id + '_settings" class="panel-heading"><span style="padding-right: 15px;" class="fas fa-cog"></span>Cell settings</div>' + cellSettingsCollapseHtml + '<div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-users-cog"></span>MaxHsAdmUsers</div><div class="col-lg-4"><input style="text-align: center;" value="'
 var part11 = '" type="text" class="form-control" id="cell_';
 var part12 = '_hsAdmUsersValue"></div></div><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-users-cog"></span>MaxSpeechAdmUsers</div><div class="col-lg-4"><input style="text-align: center;" value="';
 var part13 = '" type="text" class="form-control" id="cell_';
 var part14 = '_speechAdmUsersValue"></div></div><div class="row setting"><div class="col-lg-12"><button onclick="setCellSettings(';
 var part15 = ')" class="btn btn-primary btn-block" type="button">Save settings<span style="padding-left: 15px;" class="fas fa-save"></span></button></div></div></div></div></div></div></div>';
 
 finalInnerHtml = part1 + id + part2 + id + part3 + part4 + part5 + id + part6 + glyphicon + part7 + id + part8 + getCellById(id).eulHsUsersCount + part9 + getCellById(id).speechUsersCount + part10 + getCellById(id).hsAdmUsers + part11 + id + part12 + getCellById(id).speechAdmUsers + part13 + id + part14 + id + part15;
 
 return finalInnerHtml;
}

function prepareUeSettingsPanel(id){

 var ueInfoCollapse = false;
 var ueActionsCollapse = false;
 var ueSettingCollapse = false;

 var finalInnerHtml ='';
 
 var part1 = '<div class="panel panel-default"><div class="panel-heading"><b>UE';
 var part2 = '</b><span style="padding-right: 15px; float: right;" id="UE_';
 var part3 = '_lockSpan" onclick=';
 var part4 = '"lockPanel(';
 var part5 = "'UE' ,"; 
 var part6 = ')" class="'
 var glyphicon = 'fas fa-lock-open';
  
 for(var i = 0; i < sidebarElements.length; i++){
	if(sidebarElements[i][0] == "UE" && sidebarElements[i][1] == id){
		if(sidebarElements[i][2]){
			glyphicon = 'fas fa-lock';
		}
		
		if(sidebarElements[i][3]){ //info collapse
			ueInfoCollapse = true;
		}
		
		if(sidebarElements[i][4]){ //info collapse
			ueActionsCollapse = true;
		}
		
		if(sidebarElements[i][5]){ //info collapse
			ueSettingCollapse = true;
		}
	}
	
 }
 
 var part7 = '"></span></div><div class="panel-body"><div class="panel panel-default"><div onclick="setCollapse(' + "'UE'" + ',' + id + ",'info'" + ')" data-toggle="collapse" href="#ue_';
 var part8 = '_Info"  class="panel-heading"><span style="padding-right: 15px;" class="fas fa-info"></span>UE info</div><div id="ue_';
 var part9;
 
 if(ueInfoCollapse){
	part9 = '_Info" class="panel-collapse collapse in" aria-expanded="true" style=""><div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-mobile-alt"></span>UE id</div><div style="padding-right: 30px; text-align:right;" class="col-lg-4">';
 }else{
	part9 = '_Info" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;"><div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-mobile-alt"></span>UE id</div><div style="padding-right: 30px; text-align:right;" class="col-lg-4">';
 }
 
 var part10 = '</div></div><div class="row setting"><div class="col-lg-6"><span style="padding-right: 15px;" class="fas fa-plug"></span>Current connection</div><div id="ue_';
 var part11 = '_conn" style="padding-right: 30px; text-align:right;" class="col-lg-6">';
 var part12 = '</div></div><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="far fa-circle"></span>Start cell</div><div id="ue_';
 var part13 = '_startCell" style="padding-right: 30px; text-align:right;" class="col-lg-4">Cell_';
 var part14 = '</div></div><div class="row setting"><div class="col-lg-6"><span style="padding-right: 15px;" class="fas fa-bullseye"></span>Active set</div><div id="ue_';
 var part15 = '_activeSet" style="padding-right: 30px; text-align:right;" class="col-lg-6">';
 var part16 = '</div></div></div></div></div><div class="panel panel-default"><div onclick="setCollapse(' + "'UE'" + ',' + id + ",'actions'" + ')" data-toggle="collapse" href="#ue_';
 var part17 = '_Actions" class="panel-heading"><span style="padding-right: 15px;" class="fas fa-play"></span>UE actions</div><div id="ue_';
 
 var part18;
 if(ueActionsCollapse){
	part18 = '_Actions" class="panel-collapse collapse in" aria-expanded="true" style=""><div class="panel-body"><div class="row setting"><div id="ue_';
 }else{
	part18 = '_Actions" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;"><div class="panel-body"><div class="row setting"><div id="ue_';
 }
 
 var part19 = '_speechCallButton" class="col-lg-12">';
 
 var part20;
 
 if(getUeById(id).csconnection){
	part20 = getStopSpeechButtonForUe(id);
 }else{
	part20 = getStartSpeechButtonForUe(id);
 }
 
 var part21 = '</div></div><div class="row setting"><div id="ue_';
 var part22 = '_psCallButton" class="col-lg-12">';
 
 var part23;
 
 if(getUeById(id).psconnection){
	part23 = getStopPsButtonForUe(id);
 }else{
	part23 = getStartPsButtonForUe(id);
 }
 
 var part24 = '</div></div></div></div></div><div class="panel panel-default"><div onclick="setCollapse(' + "'UE'" + ',' + id + ",'settings'" + ')"  data-toggle="collapse" href="#ue_';
 var part25 = '_Settings" class="panel-heading"><span style="padding-right: 15px;" class="fas fa-cog"></span>UE settings</div><div id="ue_';
 var part26;
 
 if(ueSettingCollapse){
	part26 = '_Settings" class="panel-collapse collapse in" aria-expanded="true" style=""><div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-sort-amount-up"></span>Speech priority</div><div class="col-lg-4"><input style="text-align: center;" value="';
 }else{
	part26 = '_Settings" class="panel-collapse collapse" aria-expanded="false" style="height:0px;"><div class="panel-body"><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-sort-amount-up"></span>Speech priority</div><div class="col-lg-4"><input style="text-align: center;" value="';
 }
 
 var part27 = '" type="text" class="form-control" id="ue_';
 var part28 = '_speechPriority"></div></div><div class="row setting"><div class="col-lg-8"><span style="padding-right: 15px;" class="fas fa-sort-amount-up"></span>PS priority</div><div class="col-lg-4"><input style="text-align: center;" value="';
 var part29 = '" type="text" class="form-control" id="ue_';
 var part30 = '_psPriority"></div></div><div class="row setting"><div class="col-lg-12"><button onclick="setUeSettings(';
 var part31 = ')" class="btn btn-primary btn-block" type="button">Save settings<span style="padding-left: 15px;" class="fas fa-save"></span></button></div></div></div></div></div></div></div>';
 
 finalInnerHtml = part1 + id + part2 + id + part3 + part4 + part5 + id + part6 + glyphicon + part7 + id + part8 + id + part9 + id + part10 + id + part11 + getUeById(id).connectionInfo() + part12 + id + part13 + getUeById(id).startCell + part14 + id + part15 + getUeById(id).activeSetToString() + part16 + id + part17 + id + part18 + id + part19 + part20 + part21 + id + part22 + part23 + part24 + id + part25 + id + part26 + getUeById(id).speechPriority + part27 + id + part28 + getUeById(id).psPriority + part29 + id + part30 + id + part31;
 
 return finalInnerHtml;
 
}

function setCollapse(elementName, elementId, panelName){
	
	if(elementName == "UE")
	{	
		for(var i = 0; i < sidebarElements.length; i++){
			if(sidebarElements[i][0] == "UE" && sidebarElements[i][1] == elementId){
				
				if(panelName == "info"){
					sidebarElements[i][3] = !sidebarElements[i][3];
				}
				if(panelName == "actions"){
					sidebarElements[i][4] = !sidebarElements[i][4];
				}
				
				if(panelName == "settings"){
					sidebarElements[i][5] = !sidebarElements[i][5];
				}
			}
		}
	}else{
		for(var i = 0; i < sidebarElements.length; i++){
			if(sidebarElements[i][0] == "Cell" && sidebarElements[i][1] == elementId){
				
				if(panelName == "info"){
					sidebarElements[i][3] = !sidebarElements[i][3];
				}
				
				if(panelName == "settings"){
					sidebarElements[i][4] = !sidebarElements[i][4];
				}
			}
		}

	}
}

function getStopSpeechButtonForUe(id){
	var buttonHtml = '<button onclick="getUeById(' + id + ').stopCsConnection()" class="btn btn-danger btn-block" type="button" >Stop speech<span style="padding-left: 15px;" class="fas fa-phone"></span></button>';
	
	return buttonHtml;
}

function getStartSpeechButtonForUe(id){
		var buttonHtml = '<div class="dropdown"><button class="btn btn-success dropdown-toggle btn-block" type="button" data-toggle="dropdown">Start speech call<span style="padding-left:15px;" class="fas fa-phone"></span></button><ul style="text-align:center;" class="dropdown-menu btn-block">' + getTerminatingUesList(id) +  '</ul></div>';
	
		return buttonHtml;
}

function getStopPsButtonForUe(id){
	return '<button onclick="getUeById(' + id + ').stopPsConnection()" class="btn btn-warning btn-block" type="button" >Stop PS<span style="padding-left: 15px;" class="fas fa-exchange-alt"></span></button>';
}

function getStartPsButtonForUe(id){
	return '<button onclick="getUeById(' + id + ').startPsConnection()" class="btn btn-primary btn-block" type="button" >Start PS<span style="padding-left: 15px;" class="fas fa-exchange-alt"></span></button>';
}

function getTerminatingUesList(id){
	
	var listElementId = 'ue_' + id + '__terminatingUeList';
	var listHtml = '';

	for(var i = 0; i < ueArray.length; i++){
		if(ueArray[i].id != id && ueArray[i].csconnection == false){
			listHtml += '<li><a onclick="getUeById(' + id + ').startCsConnection(' + ueArray[i].id + ')" >UE_' + ueArray[i].id + '</a></li>'
		}
	}
	
	return listHtml;
	
	
}

//testing

function startQueueingTimeUE1(){

	getCellById(1).showQueue();
	getCellById(2).showQueue();
	getCellById(3).showQueue();
}

function stopQueueingTimeUE1(){
	getCellById(1).hideQueue();
	getCellById(2).hideQueue();
	getCellById(3).hideQueue();
}

</script>

</head>

<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-lg-7">
			<div class="row">
				<section id="holder"></section>
			</div>
		</div>
		
		<div id="sidebar" class="col-lg-3 sidebar">
		</div>
		
		<div id="mainbar" class="col-lg-2 mainbar">
			<div class="row" style="margin-left:0px; margin-right:0px;">
				<ul class="nav nav-pills nav-stacked left-menu">
					<li>
					  <button class="btn-mainbar-1 btn-block" type="button" data-target="#item1" data-toggle="collapse" data-parent="#stacked-menu">Cells<span style="padding-left: 15px;" class="fas fa-broadcast-tower"></span></button>
					  <ul class="nav nav-stacked collapse left-submenu" id="item1">
						<li onclick="getCellSettings(1)" class="btn-mainbar-2 btn-block">Cell 1</li>
						<li onclick="getCellSettings(2)" class="btn-mainbar-2 btn-block">Cell 2</li>
						<li onclick="getCellSettings(3)" class="btn-mainbar-2 btn-block">Cell 3</li>
					  </ul>
					</li>
					<li>
					  <button onclick="getUesListForDropDown()" class="btn-mainbar-1 btn-block" type="button" data-target="#uesDropdownList" data-toggle="collapse" data-parent="#stacked-menu">UEs<span style="padding-left: 15px;" class="fas fa-mobile-alt"></span></button>         
					  <ul id="uesDropdownList" class="nav nav-pills nav-stacked collapse" id="item2">
					  </ul>
					</li>
				</ul>
			</div>
			<div id="logsShort" class="row" style="margin-left:0px; margin-right:0px; position:relative; top: 10px;">
			  
			</div>			
			<div class="row" style="margin-left:0px; margin-right:0px; position:relative; top: 2px;">
				<button type="button" class="btn-mainbar-1 btn-block custom-modal" >Show all logs<span style="padding-left: 15px;" class="far fa-file-alt"></span></button>
			</div>
			<div class="row" style="margin-left:0px; margin-right:0px; position:relative; top: 2px;">
				<!--<button onclick="startQueueingTimeUE1();" type="button" class="btn-mainbar-1 btn-block" >Show queues</button>
				<button onclick="stopQueueingTimeUE1();" type="button" class="btn-mainbar-1 btn-block" >Hide queues</button>-->
			</div>
		</div>
	</div>
</div>

<!-- Modal all loghs -->
<div id="modalAllLogs" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Logs</h4>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

</body>
</html>