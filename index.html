<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM Frame - Fit Template</title>

<!-- Welcome to ZIM at https://zimjs.com - Code Creativity!              	        -->
<!-- ZIM runs on the HTML Canvas powered by JavaScript and CreateJS https://createjs.com -->
<!-- Founded by Inventor Dan Zen - http://danzen.com - Canadian New Media Award Winner 	-->
<!-- ZIM is free to use. You can donate to help improve ZIM at http://zimjs.com/donate 	-->

<script src="js/createjs_1.1_min.js"></script>
<script src="js/zim_7.3.2.js"></script>
<!-- use zimjs.com/distill for minified individual functions! -->

<style>

	body {background-color:#ddd;}
	article {font-size:14px; font-family:verdana; padding:20px;  margin:20px; color:#555; position:relative; width:60%; border:thin solid #888;}

	#holder {position:relative; margin:0px 0px;}
	/*
	zim Frame makes a canvas tag and adds it to the div called holder
	the id of canvas tag is holderCanvas (Frame adds the word Canvas to the holder id)
	here we are using CSS to scale the canvas but the stage dimensions stay fixed to the values provided to Frame
	*/
	#holderCanvas {width:100%;}
	
	.sidebar{
      padding: 20px 15px;
      background:  #fff;
	  height: 100vh;
	  overflow: auto;
      border-right: 1px solid #C7B4A6;
    }
	
	#mainbar{
		padding: 0px;
		position: relative;
		height: 100vh;
		overflow: auto;
		background-color: gray;
    }
	
	span{
	padding-left: 15px;
	}

.btn-mainbar-1 {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #424242), color-stop(1, #4d4d4d));
	background:-moz-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-webkit-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-o-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:-ms-linear-gradient(top, #424242 5%, #4d4d4d 100%);
	background:linear-gradient(to bottom, #424242 5%, #4d4d4d 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#424242', endColorstr='#4d4d4d',GradientType=0);
	background-color:#424242;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	border: 0px;
	font-family:Arial;
	font-size:14px;
	font-weight:bold;
	padding:10px 30px;
	text-decoration:none;
}
.btn-mainbar-1:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #4d4d4d), color-stop(1, #424242));
	background:-moz-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-webkit-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-o-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:-ms-linear-gradient(top, #4d4d4d 5%, #424242 100%);
	background:linear-gradient(to bottom, #4d4d4d 5%, #424242 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#4d4d4d', endColorstr='#424242',GradientType=0);
	background-color:#4d4d4d;
}
.btn-mainbar-1:active {
	position:relative;
	top:1px;
}

.btn-mainbar-2 {
	background-color:#ffffff;
	display:inline-block;
	cursor:pointer;
	color:#000000;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:10px 23px;
	border: 0px;
	text-decoration:none;
}
.btn-mainbar-2:hover {
	background-color:#bababa;
}
.btn-mainbar-2:active {
	position:relative;
	top:1px;
}

.setting{
	margin-bottom: 10px;
}

#cellIdSettingValue, #eulHsUsersCountSettingValue, #speechUsersCountSettingValue{
	text-align: right;
}
	

</style>

<script>

var frame;
var ERICSSON_BLUE = "#032564"
var WHITE = "#D2D2D2"
var cellArray = new Array();
var ueGuiContainer = new Container();
var ueArray = new Array();

//sidebar variables
function sidebarElement(elamentName, elementId, isLocked){
	this.elamentName = elamentName;
	this.elementId = elementId;
	this.isLocked = isLocked;
} 
var sidebarElements = new Array();

const connectionType = {
    EULHS: 'int_eul_hs',
    SPEECH: 'speech_12_2',
    SPEECHEULHS: 'int_eul_hs_speech_12_2',
}


function Cell(id, resources, startPosX, startPosY) {
  this.id = id;
  this.eulHsUsersCount = 0;
  this.speechUsersCount = 0;
  this.hsAdmUsers = resources;
  this.speechAdmUsers = resources;
  this.psresources = resources;
  this.csresources = resources;
  this.startPosX = startPosX;
  this.startPosY = startPosY;
  
  this.getInfo = function() 
  {
	return 'cell_id: ' + this.id + ', resources: ' + this.resources; 
  };
  
  this.admissionReq = function(connType){
  
	switch(connType)
	{
		case connectionType.EULHS:
			if(this.psresources > 0){
				return true;
			}else{
				zog("admission reject cell: " + this.id);
				return false;
			}
		break;
		case connectionType.SPEECH:
			if(this.csresources > 0){
				return true;
			}else{
				zog("admission reject cell: " + this.id);
				return false;
			}
		break;
		default:
	}
  }
}

function UE(id, startPosX, startPosY){

	this.id = id;
    this.startPosX = startPosX;
    this.startPosY = startPosY;
	this.psconnection = false;
	this.csconnection = false;
	this.connectionInfo = function(){
		if(this.psconnection && this.csconnection)
		{
			return 'int_eul_hs_speech_12_2'
		}
		else if(this.psconnection)
		{
			return 'int_eul_hs'
		}
		else if(this.csconnection)
		{
			return 'speech_12_2'
		}
		return undefined;
	}
	this.activeSet = new Array();
	
	this.startPsConnection = function(){
		
		if(this.csconnection == true)
		{
			for(var i = 0; i < this.activeSet.length; i++)
			{
				if(!getCellById(this.activeSet[i]).admissionReq(connectionType.EULHS)){
					return;
				}
			}
			
			for(var i = 0; i < this.activeSet.length; i++)
			{
				getCellById(this.activeSet[i]).psresources--;
			}
			
			this.psconnection = true;
		}
		else
		{
			if(!getCellById(this.startCell).admissionReq(connectionType.EULHS)){
					return;
			}
			getCellById(this.startCell).psresources--;
			this.psconnection = true;
		}
		this.updateActiveSet(cellArray);
	}
	
	this.stopPsConnection = function(){
	
		this.psconnection = false;
		this.updateActiveSet(cellArray);
	}
	
	this.startCsConnection = function(){
		if(this.psconnection == true)
		{
			for(var i = 0; i < this.activeSet.length; i++)
			{
				if(!getCellById(this.activeSet[i]).admissionReq(connectionType.SPEECH)){
					return;
				}
			}
			
			for(var i = 0; i < this.activeSet.length; i++)
			{
				getCellById(this.activeSet[i]).csresources--;
			}
			this.csconnection = true;
		}
		else
		{
			if(!getCellById(this.startCell).admissionReq(connectionType.SPEECH)){
					return;
			}
			getCellById(this.startCell).csresources--;
			this.csconnection = true;
		}
		this.updateActiveSet(cellArray);
	}
	
	this.stopCsConnection = function(){
		this.csconnection = false;
		this.updateActiveSet(cellArray);
	}
	
	this.getInfo = function()
	{
		return 'UE(id: ' + this.id + ', startCell: ' + this.startCell + ', activeSet = [' + this.activeSet.toString() + ']' + ', connection: ' +  this.connectionInfo() + ')';
	};
	
	this.setStartCell = function(cells)
	{
		var noOfCells = cells.length;
		var distance = 9999;
		var startCell = undefined;
		
		for(var i = 0; i<noOfCells; i++)
		{
			var c = dist(cells[i].gui.x, cells[i].gui.y,this.gui.x,this.gui.y);
			
			if(c < 300 && c < distance)
			{
				distance = c;
				startCell = cells[i].id;
			}
		}
		
		this.startCell = startCell;
		zog(this.getInfo());
	};
	
	this.updateActiveSet = function(cells)
	{
		var noOfCells = cells.length;
		
		if(this.psconnection || this.csconnection){
			for(var i = 0; i<noOfCells; i++)
			{
				var c = dist(cells[i].gui.x, cells[i].gui.y,this.gui.x,this.gui.y);
				
				var index = this.getActiveSetIndexFromCellId(cells[i].id);
				
				//zog('cell_id: ' + cells[i].id + ', ASindex: ' + index + ', distance: ' + c);
				
				if(c < 300 && index == -1 )
				{
					//zog('add cell ' + cells[i].id + ' to AS'); 
					this.activeSet.push(cells[i].id);
				}
				else if (c > 300 && index != -1)
				{
					//zog('remove cell ' + cells[i].id + 'from AS'); 
					this.activeSet.splice(index,1);
				}
			}
			
			if(isEmpty(this.activeSet)){
				this.psconnection = false;
				this.csconnection = false;
			}
		}
		else{
			this.activeSet = [];
		}
		zog(this.getInfo());
	}
	this.getActiveSetIndexFromCellId = function(id)
	{
		for(var i = 0; i < this.activeSet.length; i++){
			if(this.activeSet[i] == id)
			{
				return i;
			}
		}
		return -1;
	}
}


	// SCALING OPTIONS
	// scaling can have values as follows with full being the default
	// "fit"	sets canvas and stage to dimensions and scales to fit inside window size
	// "outside"	sets canvas and stage to dimensions and scales to fit outside window size
	// "full"	sets stage to window size with no scaling
	// "tagID"	add canvas to HTML tag of ID - set to dimensions if provided - no scaling

	var scaling = "holder"; // this will resize to fit inside the screen dimensions
	var width = 1280;
	var height = 1060;
	var color = ERICSSON_BLUE; // ZIM colors like green, blue, pink, faint, clear, etc. available globally
	var outerColor = dark; // any HTML colors like "violet", "#333", etc. fine to use

	frame = new Frame(scaling,width,height,ERICSSON_BLUE,ERICSSON_BLUE);

	frame.on("ready", function() {
		zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

		zog(frame.canvasID);
		
		var stage = frame.stage;
		var stageW = frame.width;
		var stageH = frame.height;

		ueGuiContainer.addTo(stage);
		ueGuiContainer.pos(0,0);
		// see http://zimjs.com/learn.html for video and code tutorials
		// see http://zimjs.com/docs.html for documentation
		// see http://zimjs.com/bits.html for 64 Interactive Media techniques

		// put your code here (you can delete this sample code)
		
		frame.loadAssets(["ue.png"], "assets/");
		 
		/*var console = new Container()
			.addTo(stage)
			.pos(1500, 1000);
			
		var commandInput = new TextArea({color:"#AAA", height:30, size:15, placeholder:"enter command"})
			.center(console);
		
		var buttonLabel = new Label({
		   text:"Enter",
		   size:20,
		   color:"white",
		});
		
		var button = new Button({
		   label:buttonLabel,
		   width:100,
		   height:30,
		   color:"gray",
		   rollColor: "orange",
		   corner:0
		})
		.addTo(console)
		.pos(250, 0);
			
		var commandHistoryLabels = new Container()
			.addTo(console)
			.pos(10, -30);
			
		var commandHistoryArray = new Array();
		var commandHistoryBackground = new Rectangle(350, 920, "white")
			.addTo(console)
			.pos(0,-930);
			
		commandHistoryBackground.alpha = 0.2;*/

		frame.on("complete", function() {
			
			 var cell_1 = new Cell(1,10,391,321);//cellId, resources, posX, posY
			 cellArray.push(cell_1);
			 guiAddCell(cell_1, stage);
			 
			 var cell_2 = new Cell(2,10,813,406);
			 cellArray.push(cell_2);
			 guiAddCell(cell_2, stage);
			 
			 var cell_3 = new Cell(3,10,547,742);
			 cellArray.push(cell_3);
			 guiAddCell(cell_3, stage);
			 
			 var ue_1 = new UE(1, 500, 500);
			 ueArray.push(ue_1);
			 guiAddUe(ue_1, stage);
			 
			 var ue_2 = new UE(2, 700, 500);
			 ueArray.push(ue_2);
			 guiAddUe(ue_2, stage);
			 
			 
			ueGuiContainer.on("pressup", function(e){
			 
				if(!getUeById(e.target.name).psconnection && !getUeById(e.target.name).csconnection){
					getUeById(e.target.name).setStartCell(cellArray);
				}
			});
			
			interval(1000, function(){
				for(var i = 0; i < ueArray.length; i++){
					if(ueArray[i].csconnection || ueArray[i].psconnection){
						ueArray[i].updateActiveSet(cellArray);
					}
				}
			})
			 
			/*button.on("click", function()
			{
				submitCommand(commandInput,commandHistoryArray,commandHistoryLabels );
			});*/
			 
			stage.update(); // this is needed to show any changes
		}); //end of complete 
		
		stage.update();

		
	}); // end of ready


function guiAddCell(cell, stage){
	//create cell gui container
	cell.gui = new Container();
	
	stage.addChild(cell.gui);
	cell.gui.bot();
	
	//setup start position
	cell.gui.x = cell.startPosX; 
	cell.gui.y = cell.startPosY;
	
	//cell label
	var cell_Label = new Label("Cell_" + cell.id);
	
	//add label to gui container
	cell.gui.addChild(cell_Label);
	cell_Label.pos(-50,-25);
	
	var cell_Range = new Circle(300, WHITE);
    cell_Range.blendMode = "multiply";
	cell_Range.alpha = .5;
	cell_Range.addTo(cell.gui);// add the circle to the container and center
	cell_Range.pos(0,0);
	
	cell.gui.setBounds(0,0);
	//cell.gui.outline();
		
	//zog("Gui pos(" + cell.gui.x + "," + cell.gui.y + ")" );
	//zog("Range pos(" + cell_Range.x + "," + cell_Range.y + ")" );
	//cell.gui.drag({currentTarget:true}); // will drag cell gui
}

function guiAddUe(ue, stage){
	//create gui for whole UE interface
	ue.gui = new Container().addTo(ueGuiContainer);
	
	//UE graphic
	var phonePNG = frame.asset("ue.png").clone();
	
	phonePNG
		.sca(0.5)
		.addTo(ue.gui)
		.centerReg();
	
	phonePNG.name = ue.id;
	
	//UE label
	var ue_Label = new Label("UE_id_" + ue.id, 15);
	
	//add label to gui container
	ue.gui.addChild(ue_Label);
	ue_Label.pos(-25,-5);
	ue_Label.top();
	ue_Label.name = ue.id;
	
	ue.gui.pos(ue.startPosX,ue.startPosY);
	ue.gui.drag({currentTarget:true});
	
	ue.gui.setBounds(0,0);
	ue.setStartCell(cellArray);
}

function submitCommand(commandInput, commandHistoryArray, commandHistoryLabels){
	
	var command = commandInput.text.trim();
	
	if (command == "") return;
	
	commandOutput = command + ' - ' + checkCommand(command);
	
	commandHistoryArray.push(commandOutput);
	
	if(commandHistoryArray.length > 45)
	{
		commandHistoryArray.shift();
	}
	
	commandHistoryLabels.removeAllChildren();
	
	var j = 0;
	for(var i = commandHistoryArray.length-1; i >=0 ; i--)
	{
		var commandLabel = new Label({
		   text:commandHistoryArray[i],
		   size:15,
		   color:"white",
		})
		.addTo(commandHistoryLabels)
		.center();
		
		commandLabel.pos(0, j * (-20));
		j++;
	}
	
	commandInput.text = "";
}

function checkCommand(command){

	var commandItems = command.split(" ");
	
	if(commandItems[0] == "cell")
	{
		//setup cell
		if(getCellById(commandItems[1]) != undefined)
		{
			if(commandItems[2] == 'psresources')
			{
				if (!isNaN(parseInt(commandItems[3], 10))) {
					getCellById(commandItems[1]).psresources = parseInt(commandItems[3], 10);
					return 'EXECUTED';
				} 
				return 'resource value is not a number';
			}
			
			if(commandItems[2] == 'csresources')
			{
				if (!isNaN(parseInt(commandItems[3], 10))) {
					getCellById(commandItems[1]).csresources = parseInt(commandItems[3], 10);
					return 'EXECUTED';
				} 
				return 'resource value is not a number';
			}
			
			return 'unknown cell parameter';
		}
		return 'cell with id: ' + commandItems[1] + ' does not exist';
	}
	else if(commandItems[0] == "ue")
	{
		if(getUeById(commandItems[1]) != undefined)
		{
			if(commandItems[2] == 'start_ps')
			{
					getUeById(commandItems[1]).startPsConnection()
					return 'EXECUTED';
			}
			else if(commandItems[2] == 'stop_ps')
			{
					getUeById(commandItems[1]).stopPsConnection()
					return 'EXECUTED';
			}
			if(commandItems[2] == 'start_cs')
			{
					getUeById(commandItems[1]).startCsConnection()
					return 'EXECUTED';
			}
			else if(commandItems[2] == 'stop_cs')
			{
					getUeById(commandItems[1]).stopCsConnection()
					return 'EXECUTED';
			}
			
			
			return 'unknown ue parameter';
		}
		return 'ue with id: ' + commandItems[1] + ' does not exist';
	}
	
	return 'unknown command';
}

function getCellById(id){
	var noOfCells = cellArray.length;
	for(var i = 0; i<noOfCells; i++)
	{
		if(cellArray[i].id == id)
		{
			return cellArray[i];
		}
	}
	return undefined;
}

function getUeById(id){
	var noOfUEs = ueArray.length;
	for(var i = 0; i<noOfUEs; i++)
	{
		if(ueArray[i].id == id)
		{
			return ueArray[i];
		}
	}
	return undefined;
}

function getCellSettings(id){

	//add cell to sidebarElement
	var element = new sidebarElement("Cell",id,false); //elamentName,elementId,isLocked
	
	//remove all not locked elements
	var i = 0;
	sidebarElements.push(element);
	zog(sidebarElements);
}

function setCellSettings(id){
	var cell = getCellById(id);
}

function getUesListForDropDown(){
	var html = '';
				  //<li type="button" data-toggle="modal" data-target="#cellSettingModal"><a href="#">Cell 1</a></li>
	for(var i = 0; i<ueArray.length; i++){
		var htmlPerUe = '<li onclick="getUeSettings(' + ueArray[i].id + ')" class="btn-mainbar-2 btn-block" type="button" data-toggle="modal" data-target="#ueSettingModal">UE ' + ueArray[i].id + '</li>';
		html = html + htmlPerUe;
	}
	
	document.getElementById('uesDropdownList').innerHTML = html;
	
}

function getUeSettings(id){
	document.getElementById('sidebar').innerHTML = "UE_" + id;
}

function lockPanel(panelType, id){
	
	for(var i = 0; i < sidebarElements.length; i++){
		if(sidebarElements[i].elamentName == panelType && sidebarElements[i].elementId == id){
			sidebarElements[i].isLocked = !sidebarElements[i].isLocked;
		}
	}
	zog(sidebarElements);
}

function getActiveSettingsHtml(){
	if(activeSettingArray.length == 0){
		return;
	}
	
	var finalInnerHtml = '';
	
	for(var i = 0; i < activeSettingArray.length ; i++){
		if(activeSettingArray[0] == 'Cell'){
			finalInnerHtml = finalInnerHtml + prepareCellSettingsPanel(activeSettingArray[1]);
		}else{
			//finalInnerHtml = finalInnerHtml + prepareUeSettingsPanel(activeSettingArray[1]);
		}
	}
	
	
}

function prepareCellSettingsPanel(id){
	
}
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>

<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-lg-8">
			<div class="row">
				<section id="holder"></section>
			</div>
		</div>
		
		<div id="sidebar" class="col-lg-2 sidebar">
			<div class="panel panel-default">
				<div class="panel-heading">
					<b id="Cell_1_PanelName" >Cell</b><b id="Cell_1_PanelId" >1</b><span id="Cell_1_lockSpan" onclick="lockPanel(getElementById('Cell_1_PanelName').innerHTML , getElementById('Cell_1_PanelId').innerHTML)" class="glyphicon glyphicon-eye-close"></span>
				</div>
				<div class="panel-body">
					<div class="panel panel-default">
					  <div class="panel-heading">Cell info</div>
					  <div class="panel-body">
						<div class="row setting">
							<div class="col-lg-8">
								Cell ID
							</div>
							<div id="cell_1_IdSettingValue" class="col-lg-4">
								1
							</div>
						</div>
						<div class="row setting">
							<div class="col-lg-8">
								EULHS users count
							</div>
							<div id="cell_1_eulHsUsersCountSettingValue" class="col-lg-4">
								0
							</div>
						</div>
						<div class="row setting">
							<div class="col-lg-8">
								Speech users count
							</div>
							<div id="cell_1_speechUsersCountSettingValue" class="col-lg-4">
								0
							</div>
						</div>
					  </div>
					</div>
					<div class="panel panel-default">
					  <div class="panel-heading">Cell settings</div>
						<div class="panel-body">
							<div class="row setting">
								<div class="col-lg-8">
									hsAdmUsers
								</div>
								<div class="col-lg-4">
									<input type="text" class="form-control" id="cell_1_hsAdmUsersValue">
								</div>
							</div>
							<div class="row setting">
								<div class="col-lg-8">
									speechAdmUsers
								</div>
								<div class="col-lg-4">
									<input type="text" class="form-control" id="cell_1_speechAdmUsersValue">
								</div>
							</div>
							<div class="row setting">
								<div class="col-lg-12">
									<button onclick="setCellSettings(1)" class="btn btn-primary btn-block" type="button" >Save settings<span class="glyphicon glyphicon-save"></span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="mainbar" class="col-lg-2 mainbar">
			<ul class="nav nav-pills nav-stacked left-menu">
				<li>
				  <button class="btn-mainbar-1 btn-block" type="button" data-target="#item1" data-toggle="collapse" data-parent="#stacked-menu">Cells<span class="glyphicon glyphicon-record"></span></button>
				  <ul class="nav nav-stacked collapse left-submenu" id="item1">
					<li onclick="getCellSettings(1)" class="btn-mainbar-2 btn-block">Cell 1</li>
					<li onclick="getCellSettings(2)" class="btn-mainbar-2 btn-block">Cell 2</li>
					<li onclick="getCellSettings(3)" class="btn-mainbar-2 btn-block">Cell 3</li>
				  </ul>
				</li>
				<li>
				  <button onclick="getUesListForDropDown()" class="btn-mainbar-1 btn-block" type="button" data-target="#uesDropdownList" data-toggle="collapse" data-parent="#stacked-menu">UEs<span class="glyphicon glyphicon-phone"></span></span></button>         
				  <ul id="uesDropdownList" class="nav nav-pills nav-stacked collapse" id="item2">
				  </ul>
				</li>
			</ul>
		</div>
	</div>
</div>



</body>
</html>